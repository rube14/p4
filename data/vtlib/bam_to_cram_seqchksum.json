{
  "version":"1.0",
  "description":"steps in the alignment pipeline perform a checksum-based comparison of input and output (cram) data.",
  "subgraph_io":{
      "ports":{
          "inputs":{
              "_stdin_":"inputbam_tee",
              "cram_file":"outputcram_tee"
          }
      }
  },
  "subst_params": [
    {
      "id":"seqchksums512_file",
      "required":"yes",
      "subst_constructor":{
          "vals":[
              {"subst":"outdatadir"},
              "/",
              {"subst":"rpt"},
              ".sha512primesums512.seqchksum"
          ],
          "postproc":{"op":"concat", "pad":""}
      }
    },
    {
      "id":"seqchksumdef_file",
      "required":"yes",
      "subst_constructor":{
          "vals":[
              {"subst":"outdatadir"},
              "/",
              {"subst":"rpt"},
              ".seqchksum"
          ],
          "postproc":{"op":"concat", "pad":""}
      }
    }
  ],
  "nodes": [
    {
      "id":"inputbam_tee",
      "type":"EXEC",
      "use_STDIN": true,
      "use_STDOUT": false,
      "cmd": ["teepot", "-vv", "-w", "30000", "__BAM_SQCHKSUMDEF_OUT__", "__BAM_SQCHCKSUMS512_OUT__"],
      "comment":"allow a generous 500 minutes for the teepot timeout"
    },
    {
      "id":"seqchksumdef_bam",
      "type":"EXEC",
      "cmd": ["bamseqchksum",	"hash=crc32prod", "inputformat=bam"]
    },
    {
      "id": "seqchksums512_bam",
      "type": "EXEC",
      "use_STDIN": true,
      "use_STOUT": true,
      "cmd": ["bamseqchksum", "hash=sha512primesums512"],
      "comment": "bamseqchksum sha512primesums512 bam input"
    },
    {
      "id": "seqchksums512_file",
      "type": "OUTFILE",
      "name": {"subst":"seqchksums512_file"}
    },
    {
      "id": "seqchksumdef_file",
      "type": "OUTFILE",
      "name": {"subst":"seqchksumdef_file"}
    },
    {
      "id":"cmp_seqchksums512",
      "use_STDIN": true,
      "use_STOUT": false,
      "type":"EXEC",
      "cmd":["cmp", "-s", "__BAM_SQCHKSUMS512_IN__", "__CRAM_SQCHKSUMS512_IN__"],
      "description":"check input primary/sequence data matches CRAM output. rb11:add use_STDOUT:false?"
    },
    {
      "id":"cmp_seqchksumdef",
      "use_STDIN": true,
      "use_STOUT": false,
      "type":"EXEC",
      "cmd":["cmp", "-s", "__BAM_SQCHKSUMDEF_IN__", "__CRAM_SQCHKSUMDEF_IN__"],
      "description":"check input primary/sequence data matches output"
    },
    {
      "id":"seqchksumdef_cram",
      "type":"EXEC",
      "use_STDIN": true,
      "use_STOUT": true,
      "cmd": ["bamseqchksum", "inputformat=cram"],
      "comment":"default tool bamseqchksum must be from Biobambam >= 0.0.183; requires REF_PATH env var to work without a reference"
    },
    {
      "id": "seqchksums512_cram",
      "type": "EXEC",
      "use_STDIN": true,
      "use_STOUT": true,
      "cmd": ["bamseqchksum",	"hash=sha512primesums512", "inputformat=cram"],
      "comment": "bamseqchksum sha512primesums512 cram output"
    },
    {
      "id":"outputcram_tee",
      "type":"EXEC",
      "use_STDIN": true,
      "use_STDOUT": false,
      "cmd": ["teepot", "-vv", "-w", "30000", "__CRAM_SQCHKSUMDEF_OUT__", "__CRAM_SQCHKSUMS512_OUT__"],
      "comment":"allow a generous 500 minutes for the teepot timeout"
    }
  ],
  "edges": [
    
    { "id":"outputcram_tee_to_seqchksumdef_cram", "from": "outputcram_tee:__CRAM_SQCHKSUMDEF_OUT__", "to": "seqchksumdef_cram" },
    { "id":"seqchksumdef_cram_to_cmp_seqchksumdef", "from":"seqchksumdef_cram", "to":"cmp_seqchksumdef:__CRAM_SQCHKSUMDEF_IN__" },
    { "id":"seqchksumdef_file_to_cmp_seqchksumdef", "from":"seqchksumdef_file", "to":"cmp_seqchksumdef:__BAM_SQCHKSUMDEF_IN__" },
    { "id":"seqchksumdef_bam_to_seqchksumdef_file", "from": "seqchksumdef_bam", "to": "seqchksumdef_file" },
    { "id":"inputbam_tee_to_seqchksumdef_bam", "from": "inputbam_tee:__BAM_SQCHKSUMDEF_OUT__", "to": "seqchksumdef_bam" },
    
    { "id":"outputcram_tee_to_seqchksums512_cram", "from": "outputcram_tee:__CRAM_SQCHKSUMS512_OUT__", "to": "seqchksums512_cram" },
    { "id":"seqchksums512_cram_to_cmp_seqchksums512", "from": "seqchksums512_cram", "to": "cmp_seqchksums512:__CRAM_SQCHKSUMS512_IN__" },
    { "id":"seqchksums512_file_to_cmp_seqchksums512", "from":"seqchksums512_file", "to":"cmp_seqchksums512:__BAM_SQCHKSUMS512_IN__" },
    { "id":"seqchksums512_bam_to_seqchksums512_file", "from": "seqchksums512_bam", "to": "seqchksums512_file" },
    { "id":"inputbam_tee_to_seqchksums512_bam", "from": "inputbam_tee:__BAM_SQCHCKSUMS512_OUT__", "to": "seqchksums512_bam" }
  ]
}
